:root{
  --bg:#0d0f12;
  --bg2:#151820;
  --text:#f2f3f7;
  --muted:#a7adbd;
  --primary:#3949ab;
  --accent:#ff9800;
  --danger:#ff5252;
  --warn:#ff7043;
  --card:#1b1f2a;
  --line:#2a2f3b;
}
*{box-sizing:border-box}
html,body{
  height:100%;
  width:100%;
  overflow:hidden;
  position:fixed;
  -webkit-overflow-scrolling:touch;
}
#app{
  height:100vh;
  width:100vw;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  position:relative;
}
body{
  margin:0;
  padding:0;
  background:var(--bg);
  color:var(--text);
  font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,PingFang TC,Microsoft JhengHei,sans-serif;
}
.app-bar{
  display:flex; align-items:center; gap:12px;
  height:56px; padding:0 12px;
  background:var(--primary);
  position:sticky;
  top:0;
  z-index:5;
}
.app-title{font-weight:700}
.icon-btn,.btn,.ctrl{
  appearance:none;border:none;outline:none;
  background:transparent;color:inherit;font:inherit;
  padding:8px 10px;border-radius:10px;cursor:pointer;
}
.btn{background:#2a2f3b}
.btn.primary{background:var(--accent);color:#000;font-weight:700}
.btn.text{background:transparent}
.btn.danger{background:var(--danger)}
.btn.stop{
  background:#ffa726;
  color:#000;
  font-weight:700;
}
.btn.wide{width:100%}
.icon-btn{font-size:20px}
.drawer{
  position:fixed;top:56px;left:0;bottom:0;width:260px;
  background:var(--bg2);transform:translateX(-100%);
  transition:transform .2s ease;z-index:100;box-shadow: 2px 0 12px rgba(0,0,0,.4);
}
.drawer.open{transform:translateX(0)}
.drawer-backdrop{
  position:fixed;inset:0;background:rgba(0,0,0,.5);
  z-index:99;opacity:0;pointer-events:none;
  transition:opacity .2s ease;
}
.drawer-backdrop.active{
  opacity:1;pointer-events:auto;
}
.drawer-backdrop.active ~ .drawer{
  pointer-events:auto;
}
.drawer-header{padding:14px 16px;color:var(--muted);border-bottom:1px solid var(--line)}
.drawer-item{
  display:flex;align-items:center;gap:10px;width:100%;
  padding:14px 16px;background:transparent;border:none;color:var(--text);
  border-bottom:1px solid var(--line);cursor:pointer;
}
.view{
  padding:10px 12px 24px 12px;
  flex:1;
  display:block;
  min-height:calc(100vh - 56px);
}
.card-list{
  flex:1;
  overflow-y:auto;
  overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  touch-action:pan-y;
  min-height:0;
  padding-bottom:120px;
  display:grid;
  gap:10px;
  align-content:start;
}
.cycle-list{
  flex:1;
  overflow-y:auto;
  overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  touch-action:pan-y;
  min-height:0;
  padding-bottom:80px;
}
.section-header{display:flex;align-items:center;justify-content:space-between;margin:12px 0}
.title{font-size:20px;font-weight:700}
.card{
  background:var(--card);border:1px solid var(--line);border-radius:12px;padding:12px;
}
.card .desc{color:var(--muted);font-size:14px}
.card .meta{margin-top:6px;color:var(--muted);font-size:13px;border-top:1px solid var(--line);padding-top:6px}
.home{
  position:relative;
  height:100%;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  padding:8px 0 0 0;
}
.home-fixed{
  flex-shrink:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:4px;
  padding-bottom:8px;
  background:var(--bg);
  z-index:2;
  width:100%;
}
@media (max-width:768px){
  .home-fixed{
    gap:2px;
    padding-bottom:4px;
  }
}
.home .timer-header{
  display:none;
}
.timer-wrapper{
  position:relative;
  display:flex;
  justify-content:center;
  align-items:center;
  margin:2px 0;
  width:min(92vw,280px);
}
@media (max-width:768px){
  .timer-wrapper{
    margin:1px 0;
    width:min(60vw,150px);
  }
}
.home .timer{
  position:relative;
  display:flex;
  justify-content:center;
  width:100%;
  touch-action:manipulation;
  -webkit-touch-callout:none;
  -webkit-user-select:none;
  user-select:none;
}
.home .timer canvas{
  width:100%;
  height:auto;
  touch-action:manipulation;
  pointer-events:none;
}
.timer-wrapper{
  position:relative;
  display:flex;
  justify-content:center;
  align-items:center;
  width:min(92vw,360px);
  margin:0 auto 8px;
  touch-action:manipulation;
  -webkit-touch-callout:none;
}
.corner-controls{
  position:absolute;
  inset:0;
  pointer-events:none;
}
.corner-btn{
  position:absolute;
  --corner-translate: translate(0,0);
  --corner-offset:14px;
  --corner-top-offset:60px;
  width:78px;
  height:78px;
  border:none;
  border-radius:50%;
  background:#2a2f3b;
  color:#fff;
  font-size:18px;
  font-weight:700;
  display:flex;
  align-items:center;
  justify-content:center;
  transform:var(--corner-translate);
  box-shadow:0 4px 14px rgba(0,0,0,.35);
  cursor:pointer;
  pointer-events:auto;
  transition:transform .12s ease, box-shadow .12s ease;
  z-index:6;
}
.corner-btn:active{
  transform:var(--corner-translate) scale(0.95);
  box-shadow:0 2px 8px rgba(0,0,0,.25);
}
.corner-btn.warn{background:var(--warn);color:#000;}
.corner-btn.warn.paused{
  background:#2a2f3b;
  color:#fff;
}
.corner-btn.danger{background:#e84e63;}
.corner-btn.lung{background:#ffb74d;color:#000;}
#plus10Btn{background:#4a5568;font-size:13px;font-weight:600;}
.corner-btn.corner-top-left{
  top:var(--corner-top-offset);
  left:var(--corner-offset);
  --corner-translate:translate(-75%,-75%);
}
.corner-btn.corner-top-right{
  top:var(--corner-top-offset);
  right:var(--corner-offset);
  --corner-translate:translate(75%,-75%);
}
.corner-btn.corner-bottom-right{
  bottom:var(--corner-offset);
  right:var(--corner-offset);
  --corner-translate:translate(50%,50%);
}
.corner-btn.corner-bottom-left{
  bottom:var(--corner-offset);
  left:var(--corner-offset);
  --corner-translate:translate(-50%,50%);
}
.corner-btn .corner-label{
  display:flex;
  align-items:center;
  justify-content:center;
  padding:0;
  line-height:1;
  text-align:center;
  pointer-events:none;
  font-size:36px;
  font-weight:700;
  background:transparent;
  transform:translateY(-2px);
}
#plus10Btn .corner-label{font-size:24px;font-weight:700;}
.corner-btn.disabled{
  opacity:.4;
  filter:grayscale(1);
  pointer-events:none;
}
@media (max-width:768px){
  .corner-btn{
    width:56px;
    height:56px;
    font-size:15px;
  }
  #plus10Btn{font-size:11px;}
  .corner-btn .corner-label{
    font-size:26px;
    transform:translateY(-1px);
  }
  #plus10Btn .corner-label{font-size:16px;font-weight:700;transform:translateY(0);}
  /* 左上開始鍵：再往右移 */
  .corner-btn.corner-top-left{
    top:45px;
    left:35px;
    --corner-translate:translate(-60%,-60%);
  }
  /* 右上跳過鍵：再往左移 */
  .corner-btn.corner-top-right{
    top:45px;
    right:35px;
    --corner-translate:translate(60%,-60%);
  }
  /* 左下肺部鍵：再往右移 */
  .corner-btn.corner-bottom-left{
    bottom:28px;
    left:35px;
    --corner-translate:translate(-45%,45%);
  }
  /* 右下加秒鍵：再往左移 */
  .corner-btn.corner-bottom-right{
    bottom:28px;
    right:35px;
    --corner-translate:translate(45%,45%);
  }
}
.home .controls.primary{
  flex-shrink:0;
  margin-top:2px;
  gap:6px;
  width:100%;
  max-width:640px;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-wrap:wrap;
}
@media (max-width:768px){
  .home .controls.primary{
    margin-top:0;
    gap:4px;
    flex-wrap:nowrap;
    justify-content:space-between;
    padding:0 8px;
  }
  .home .controls.primary .btn{
    padding:6px 8px;
    font-size:14px;
    flex:1;
    min-width:0;
  }
  .home .controls.primary .fab.lung{
    width:36px;
    height:36px;
    font-size:18px;
    flex-shrink:0;
  }
}
.home .controls.secondary{
  display:none;
}
.session-table{
  flex:1;
  overflow-y:auto;
  overflow-x:hidden;
  margin-top:8px;
  border-top:1px solid var(--line);
  width:100%;
  max-width:640px;
  margin-left:auto;
  margin-right:auto;
  padding:0;
  -webkit-overflow-scrolling:touch;
  min-height:0;
  touch-action:pan-y;
  overscroll-behavior:contain;
  overscroll-behavior-y:contain;
  position:relative;
}
.timer-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;pointer-events:none}
.time{font-size:44px;font-weight:800}
@media (max-width:768px){
  .time{font-size:42px}
  .phase{font-size:16px}
}
.phase{margin-top:4px;color:var(--muted)}
.controls{display:flex;gap:10px;align-items:center;justify-content:center;margin:10px 0;flex-wrap:wrap}
.controls .fab.lung{width:44px;height:44px;border-radius:50%;background:#ffb74d;color:#000;font-size:20px;font-weight:700}
.controls .fab.disabled,.badge.disabled{opacity:.4;filter:grayscale(1);pointer-events:none}
.ctrl{
  width:48px;
  height:48px;
  border-radius:50%;
  background:#2a2f3b;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
}
.ctrl.warn{background:var(--warn)}
.ctrl.danger{
  background:#e84e63;
  font-size:24px;
}
.ctrl.stop{background:#ffa726;color:#000;font-weight:700}
#plus10Btn{
  font-size:14px;
  font-weight:600;
  text-align:center;
  padding:0;
  background:#4a5568 !important;
  color:#fff !important;
}
#plus10Btn:hover{
  background:#5a6578 !important;
}
#plus10Btn:active{
  background:#3a4558 !important;
}
.ctrl.disabled{
  opacity:.4;
  filter:grayscale(1);
  pointer-events:none;
}
.btn.disabled{
  opacity:.4;
  filter:grayscale(1);
  pointer-events:none;
  cursor:not-allowed;
}
.badge{padding:6px 10px;border-radius:12px;background:#2a2f3b;color:#ffd}
.badge .small{font-size:12px;color:#ffc}
.session-table{
  margin-top:10px;
  border-top:1px solid var(--line);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
.session-table .grid-header{
  position:sticky;
  top:0;
  z-index:10;
  background:var(--bg);
  border-bottom:2px solid var(--line);
}
.grid-header,.cycle-row{
  display:grid;grid-template-columns:40px 1fr 1fr 60px;align-items:center;
  border-bottom:1px solid var(--line);min-height:56px;
  column-gap:24px;
  padding:0 12px;
}
.session-table .grid-header,
.session-table .cycle-row{
  padding:0 12px;
}
.grid-header{color:var(--muted);font-size:14px}
.grid-header > div:nth-child(2),
.grid-header > div:nth-child(3){
  text-align:center;
}
.grid-header .add-in-header{
  font-size:24px;
  padding:0;
  width:40px;
  height:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:var(--accent);
  color:#000;
  border-radius:8px;
  font-weight:700;
  cursor:pointer;
  transition:all 0.2s ease;
  box-shadow:0 2px 4px rgba(0,0,0,0.2);
}
.grid-header .add-in-header:active{
  transform:scale(0.95);
  box-shadow:0 1px 2px rgba(0,0,0,0.2);
}
.grid-header .right{
  display:flex;
  justify-content:flex-end;
  align-items:center;
}
.grid-header .right .icon-btn{
  font-size:20px;
  padding:0;
  width:40px;
  height:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#2a2f3b;
  color:var(--text);
  border-radius:8px;
  cursor:pointer;
  transition:all 0.2s ease;
  box-shadow:0 2px 4px rgba(0,0,0,0.2);
}
.grid-header .right .icon-btn:active{
  transform:scale(0.95);
  box-shadow:0 1px 2px rgba(0,0,0,0.2);
}
.grid-header .right .icon-btn.active{
  background:var(--accent);
  color:#000;
  font-weight:700;
  box-shadow:0 2px 8px rgba(255,152,0,0.4);
}
.cycle-row input{
  width:100%;background:transparent;border:none;color:var(--text);
  padding:10px 8px;font-size:16px;text-align:center;
}
.cycle-row > div:nth-child(2),
.cycle-row > div:nth-child(3){
  text-align:center;
}
.cycle-row{
  transition:transform .16s ease;
  -webkit-user-select:none;
  -moz-user-select:none;
  -ms-user-select:none;
  user-select:none;
}
.cycle-row.dragging{
  opacity:.9;
  background:rgba(255,255,255,.02);
  -webkit-user-select:none;
  -moz-user-select:none;
  -ms-user-select:none;
  user-select:none;
  z-index:50;
}
.cycle-row.active-row{
  background:rgba(57,73,171,.15);
  border-left:3px solid var(--primary);
}
.time-cell{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:4px;
}
.time-cell .main{
  display:flex;
  align-items:center;
  gap:6px;
}
.time-cell .phase-indicator{
  color:var(--accent);
  font-size:16px;
}
.time-cell.active-phase .main span{
  font-weight:700;
}
.time-cell .diag{
  color:var(--accent);
  font-size:12px;
}

@media (max-width:768px){
  .home{
    padding-bottom:16px;
  }
  .home .timer{
    width:min(78vw,300px);
  }
  .session-table{
    max-height:calc(100vh - 420px);
    overflow-y:auto;
    -webkit-overflow-scrolling:touch;
  }
}

@media (max-width:480px){
  .home .timer{
    width:min(74vw,260px);
  }
  .home .controls.primary,
  .home .controls.secondary{
    gap:6px;
  }
}

@media (min-width:1024px){
  .home-fixed{
    position:static;
    top:auto;
  }
  .session-table{
    max-height:none;
    overflow:visible;
  }
}
.row-placeholder{
  border-radius:12px;
  background:rgba(255,255,255,.04);
  border:1px dashed rgba(255,255,255,.12);
  transition:background .2s ease;
  pointer-events:none;
}
.dragging-global{user-select:none;cursor:grabbing;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;touch-action:none}
.right{text-align:right;padding-right:6px}
.handle{
  cursor:grab;
  color:var(--muted);
  font-size:18px;
  padding:8px;
  user-select:none !important;
  -webkit-user-select:none !important;
  -moz-user-select:none !important;
  -ms-user-select:none !important;
  touch-action:none !important;
  -webkit-touch-callout:none !important;
  -webkit-tap-highlight-color:transparent !important;
  -webkit-user-drag:none;
  -khtml-user-drag:none;
  -moz-user-drag:none;
  -o-user-drag:none;
  user-drag:none;
  pointer-events:auto;
}
.handle:active{
  cursor:grabbing;
  user-select:none !important;
  -webkit-user-select:none !important;
}
.trash{color:#ff9800}
.modal-backdrop{
  position:fixed;inset:0;background:rgba(0,0,0,.6);
  display:flex;align-items:flex-end;justify-content:center;z-index:20;
}
.modal{
  width:100%;max-width:480px;background:var(--bg2);
  border-radius:16px 16px 0 0;padding:14px;
}
.modal-title{font-weight:700;margin-bottom:8px}
input::placeholder{color:#6b7280}
button:disabled{opacity:.5;pointer-events:none}

/* time picker */
.time-picker{
  display:flex;gap:12px;align-items:center;justify-content:center;margin:12px 0;
}
.time-col{
  display:flex;flex-direction:column;align-items:center;gap:6px;
}
.time-col label{color:var(--muted);font-size:12px}
.time-col select{
  background:var(--card);color:var(--text);border:1px solid var(--line);
  border-radius:10px;padding:8px 10px;font-size:18px;min-width:90px;max-height:160px;overflow:auto;
}
.time-actions{display:flex;gap:10px;margin-top:6px}

/* center edit section & tables list width */
.edit-table,.tables{
  max-width:640px;
  margin:0 auto;
  height:100%;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  touch-action:pan-y;
  -webkit-overflow-scrolling:touch;
}
.edit-table .section-header{
  flex-shrink:0;
  display:flex;
  align-items:center;
  gap:12px;
  flex-wrap:nowrap;
}
.edit-table .section-header .icon-btn{
  flex-shrink:0;
  font-size:24px;
  padding:8px;
}
.edit-table .section-header .title{
  flex:1;
  min-width:0;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.edit-table .section-header .title .table-name-highlight{
  color:var(--accent);
  font-weight:700;
  font-size:1.1em;
}
.edit-table .section-header .btn.primary{
  flex-shrink:0;
  white-space:nowrap;
}
.edit-table .form{
  flex-shrink:0;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.edit-table .form label{
  display:flex;
  flex-direction:column;
  gap:6px;
  font-size:14px;
  color:var(--muted);
}
.edit-table .form input{
  width:100%;
  padding:10px 12px;
  background:var(--card);
  border:1px solid var(--line);
  border-radius:8px;
  color:var(--text);
  font-size:16px;
}
.edit-table .form input:focus{
  outline:none;
  border-color:var(--accent);
}
.edit-table .table-container{
  flex:1;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  min-height:0;
}
.edit-table .grid-header{
  flex-shrink:0;
  position:sticky;
  top:0;
  z-index:5;
  background:var(--bg);
  border-bottom:2px solid var(--line);
}
.cycle-list{
  position:relative;
  flex:1;
  overflow-y:auto;
  overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  min-height:0;
  padding-bottom:80px;
}

/* confirm dialog */
.confirm{
  width:100%;max-width:420px;background:var(--bg2);
  border-radius:16px;padding:16px;
}
.confirm .msg{margin:8px 0 14px 0;color:var(--text)}
.confirm .actions{display:flex;gap:10px;justify-content:flex-end}

/* session specific alignment */
.session-table .grid-header,
.session-table .cycle-row{
  grid-template-columns:40px 1fr 1fr 60px;
  column-gap:16px;
}
.session-table .grid-header > div,
.session-table .cycle-row > div{
  display:flex;align-items:center;justify-content:center;
}




